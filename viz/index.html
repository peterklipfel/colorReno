<html>
  <link rel="stylesheet" href="css/leaflet.css" />
  <style>
    #map, html, body {
      width: 100%; height: 100%; padding: 0; margin: 0;
    }
    .circlePoint {
      opacity: 0;
      -webkit-animation: fadeOut 0.1s ease;
      animation: fadeOut 0.1s ease;
    }
 
    @-webkit-keyframes fadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
    @keyframes fadeOut {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }
 </style>
  <body>
    <div id="map"></div>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/jquery.csv.js"></script>
    <script src="js/leaflet.js"></script>


    <script>
      var map = new L.Map('map', {
        zoomControl: true,
        center: [39.5, -119.5],
        zoom: 11
      });
 
      $.ajax({
	    url: "data/lat_lon.csv",
	    async: false,
	    success: function (csvd) {
		data = $.csv2Array(csvd);
                for(i=0; i<data.length; i++){
                  var point = data[i]
                  setTimeout((function(point){
	            var circle = L.circle([point[1], point[0]], 500, {
	     	      color: 'red',
		      fillColor: '#f03',
		      fillOpacity: 0.5,
	            }).addTo(map);
                    circle._container.classList.add('circlePoint')
                  }).bind(null, point), parseInt(parseFloat(point[3])/50000 - 20000))
                }
	    },
	    dataType: "text",
	    complete: function () {
                console.log("done")
		// call a function on complete 
	    }
      });

      L.tileLayer('http://{s}.api.cartocdn.com/base-dark/{z}/{x}/{y}.png', {
        attribution: 'CartoDB'
      }).addTo(map);

    </script>
  </body>
</html>
